<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base target="_blank">
    <title>正在加载...</title>
    <link rel="stylesheet" href="./pie-web.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* 默认的容器样式，您可以根据需要在 pie-web.css 中覆盖 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        #markdown-content {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 0 auto;
        }
    </style>
</head>
<body>

    <div id="markdown-content">
        正在加载 README.md...
    </div>

    <script>
        const filename = 'README.md';
        const contentDiv = document.getElementById('markdown-content');

        /**
         * 提取 Markdown 文本中的第一个大标题 (H1)
         * @param {string} markdownText - 完整的 Markdown 文本
         * @returns {string|null} - 提取到的标题文本，如果没有找到则返回 null
         */
        function extractFirstH1(markdownText) {
            // 正则表达式：匹配以 # 开头，后面跟着空格，直到行尾的内容。
            // ^#\s* - 匹配行首的 # 符号，后面跟着零个或多个空格。
            // (.*) - 捕获组，匹配标题的实际文本直到行尾。
            const match = markdownText.match(/^\s*#\s*(.*)/m);
            if (match && match[1]) {
                // 返回捕获组中的内容，并去除首尾空白
                return match[1].trim();
            }
            return null;
        }

        /**
         * 异步函数：读取文件并渲染 Markdown
         */
        async function loadAndRenderMarkdown() {
            try {
                // 1. 读取文件
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`无法加载文件：${response.status} ${response.statusText}.`);
                }
                const markdownText = await response.text();

                // 2. 提取第一个大标题并设置为网站标题
                const websiteTitle = extractFirstH1(markdownText);
                if (websiteTitle) {
                    document.title = websiteTitle;
                } else {
                    document.title = 'Markdown 文档'; // 如果没有找到标题，设置一个默认标题
                }

                // 3. 使用 marked.js 将 Markdown 转换为 HTML
                const htmlContent = marked.parse(markdownText);

                // 4. 将生成的 HTML 插入到页面中
                contentDiv.innerHTML = htmlContent;

            } catch (error) {
                console.error('渲染 Markdown 失败:', error);
                contentDiv.innerHTML = `<h1 style="color: red;">加载或渲染文件失败</h1><p>错误信息: ${error.message}</p><p>请检查 <code>${filename}</code> 是否存在以及文件读取权限。</p>`;
                document.title = '加载失败';
            }
        }

        // 调用主函数
        loadAndRenderMarkdown();
    </script>

</body>
</html>