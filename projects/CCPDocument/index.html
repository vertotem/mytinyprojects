<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ä¸­å›½å…±äº§å…šå†å²æ–‡çŒ®</title>
    <link rel="stylesheet" href="./assess/docute.css">
    
    <!-- å¼•å…¥ Heti ä¸­æ–‡æ’ç‰ˆæ ·å¼ -->
    <link rel="stylesheet" href="./assess/heti.min.css">
    
    <!-- å¼•å…¥æ€æºå®‹ä½“å­—ä½“ï¼ˆä½¿ç”¨å›½å†…é•œåƒï¼‰-->
    <link rel="stylesheet" href="https://fonts.googleapis.cn/css2?family=Noto+Serif+SC:wght@400;500;600;700&display=swap">
    
    <style>
      /* å…¨å±€åº”ç”¨æ€æºå®‹ä½“ */
      body {
        font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif CN', serif;
      }
      
      /* Heti æ’ç‰ˆå¢å¼º */
      .heti {
        font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif CN', serif;
      }
      
      /* ä¸º Docute å†…å®¹åŒºåŸŸåº”ç”¨ Heti */
      .Content, .markdown-body {
        font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif CN', serif;
      }
      
      .Content article, .markdown-body {
        line-height: 2;
        text-align: justify;
      }
      
      .Content h1, .Content h2, .Content h3, .Content h4, .Content h5, .Content h6 {
        font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif CN', serif;
        font-weight: 600;
      }
      
      .Content p {
        text-indent: 2em;
        margin: 1em 0;
      }
      
      .Content p:first-child,
      .Content h1 + p,
      .Content h2 + p,
      .Content h3 + p,
      .Content h4 + p,
      .Content h5 + p,
      .Content h6 + p {
        text-indent: 0;
      }
      
      /* å›¾ç‰‡ä¸ç¼©è¿›ï¼Œå±…ä¸­æ˜¾ç¤º */
      .Content p img,
      .Content img {
        text-indent: 0;
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 100%;
        height: auto;
      }
      
      /* åŒ…å«å›¾ç‰‡çš„æ®µè½ä¸ç¼©è¿› */
      .Content p:has(img) {
        text-indent: 0;
        text-align: center;
      }
      
      /* ä¾§è¾¹æ å’Œæœç´¢æ¡†å­—ä½“ */
      .Sidebar, .sidebar-search, .search-result-item {
        font-family: 'Noto Serif SC', 'Source Han Serif SC', 'Source Han Serif CN', serif;
      }
      
      /* ä¾§è¾¹æ æœç´¢æ¡†æ ·å¼ */
      .sidebar-search {
        padding: 1rem;
        margin: 0.5rem;
        background: #fff;
        border: 2px solid #000;
        border-radius: 6px;
      }
      
      .search-input-wrapper {
        position: relative;
      }
      
      .search-input-wrapper input {
        width: 100%;
        padding: 0.6rem 2.5rem 0.6rem 0.75rem;
        background: #fff;
        border: 2px solid #000;
        border-radius: 4px;
        color: #000;
        font-size: 14px;
        font-weight: 500;
        outline: none;
        transition: all 0.2s;
      }
      
      .search-input-wrapper input:focus {
        background: #f5f5f5;
        border-color: #000;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
      }
      
      .search-input-wrapper input::placeholder {
        color: #666;
        font-weight: 400;
      }
      
      .search-icon {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: #000;
        pointer-events: none;
        font-size: 16px;
      }
      
      .search-results {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        background: #fff;
        border: 2px solid #000;
        border-top: none;
        border-radius: 0 0 6px 6px;
        margin: -0.5rem 0.5rem 0.5rem 0.5rem;
      }
      
      .search-results.active {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }
      
      .search-result-item {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e0e0e0;
        cursor: pointer;
        transition: background 0.2s;
      }
      
      .search-result-item:hover {
        background: #f0f0f0;
      }
      
      .search-result-item:last-child {
        border-bottom: none;
      }
      
      .search-result-title {
        color: #000;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 0.25rem;
        display: block;
      }
      
      .search-result-content {
        color: #333;
        font-size: 12px;
        line-height: 1.5;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
      }
      
      .search-result-content mark {
        background: #000;
        color: #fff;
        padding: 2px 4px;
        border-radius: 2px;
        font-weight: 600;
      }
      
      .search-stats {
        padding: 0.5rem 1rem;
        color: #666;
        font-size: 12px;
        font-weight: 500;
        background: #f5f5f5;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .no-results {
        padding: 2rem 1rem;
        text-align: center;
        color: #666;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="docute"></div>
    <script src="./assess/docute.js"></script>
    <script src="./assess/fuse.js@6.6.2"></script>
    
    <!-- å¼•å…¥ Heti.js -->
    <script src="./assess/heti-addon.min.js"></script>
    
    <script>
      new Docute({
        target: '#docute',
        darkTheme: true,
        sidebar: [
          {
            title: 'å†å²æ–‡çŒ®',
            children: [
              {
                title: 'ä¸­å›½å…±äº§å…šåˆ›ç«‹æ—¶æœŸ (1921.3â€”1923.5)',
                link: '/article/1921-1923/README.md'
              },
              {
                title: 'å¤§é©å‘½æ—¶æœŸ (1923.6â€”1927.7)',
                link: '/article/1923-1927/README.md'
              },
              {
                title: 'åœŸåœ°é©å‘½æˆ˜äº‰æ—¶æœŸ(1927.8â€”1937.7)',
                link: '/article/1927-1937/README.md'
              },
              {
                title: 'æŠ—æ—¥æˆ˜äº‰æ—¶æœŸ (1937.7â€”1945.8)',
                link: '/article/1937-1945/README.md'
              },
              {
                title: 'å…¨å›½è§£æ”¾æˆ˜äº‰æ—¶æœŸ (1949.10â€”1956.9)',
                link: '/article/1945-1949/README.md'
              },
              {
                title: 'åŸºæœ¬å®Œæˆç¤¾ä¼šä¸»ä¹‰æ”¹é€ æ—¶æœŸ(1949.10â€”1956.9)',
                link: '/article/1949-1956/README.md'
              },
              {
                title: 'å¼€å§‹å…¨é¢å»ºè®¾ç¤¾ä¼šä¸»ä¹‰æ—¶æœŸ(1956.8â€”1966.4)',
                link: '/article/1956-1966/README.md'
              },
              {
                title: 'ç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å»ºè®¾æ–°æ—¶æœŸ (1976.10â€”2006.3)',
                link: '/article/1976-2006/README.md'
              }
            ]
          },
          {
            title: 'ä¹¦ç±',
            children: [
              {
                title: 'ã€Šä¸­å›½å…±äº§å…šæŠ—æ—¥æ–‡ä»¶é€‰ç¼–ã€‹',
                link: '/books/book-1.md'
              }
            ]
          }
        ]
      })
      
      // æœç´¢åŠŸèƒ½
      let fuse;
      let searchIndex = [];
      
      // åŠ è½½æœç´¢ç´¢å¼•
      fetch('./search-index.json')
        .then(response => response.json())
        .then(data => {
          searchIndex = data;
          // åˆå§‹åŒ–Fuse.js
          fuse = new Fuse(searchIndex, {
            keys: ['title', 'fullContent'],
            threshold: 0.3,
            includeScore: true,
            minMatchCharLength: 2,
            ignoreLocation: true
          });
          console.log('æœç´¢ç´¢å¼•åŠ è½½å®Œæˆï¼Œå…±' + searchIndex.length + 'ä¸ªæ–‡æ¡£');
        })
        .catch(err => {
          console.error('åŠ è½½æœç´¢ç´¢å¼•å¤±è´¥:', err);
        });
      
      // ç­‰å¾…ä¾§è¾¹æ åŠ è½½å®Œæˆåæ³¨å…¥æœç´¢æ¡†
      setTimeout(() => {
        const sidebar = document.querySelector('.Sidebar');
        if (sidebar) {
          // åˆ›å»ºæœç´¢æ¡†HTML
          const searchHTML = `
            <div class="sidebar-search">
              <div class="search-input-wrapper">
                <input type="text" id="search-input" placeholder="æœç´¢æ–‡æ¡£..." autocomplete="off">
                <span class="search-icon">ğŸ”</span>
              </div>
            </div>
            <div class="search-results" id="search-results"></div>
          `;
          
          // åœ¨ä¾§è¾¹æ é¡¶éƒ¨æ’å…¥æœç´¢æ¡†
          sidebar.insertAdjacentHTML('afterbegin', searchHTML);
          
          // ç»‘å®šæœç´¢äº‹ä»¶
          const searchInput = document.getElementById('search-input');
          const searchResults = document.getElementById('search-results');
          
          let searchTimeout;
          searchInput.addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            // é˜²æŠ–
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
              if (query.length === 0) {
                searchResults.classList.remove('active');
                searchResults.innerHTML = '';
                return;
              }
              
              if (!fuse) {
                searchResults.classList.add('active');
                searchResults.innerHTML = '<div class="no-results">æœç´¢ç´¢å¼•åŠ è½½ä¸­...</div>';
                return;
              }
              
              // æ‰§è¡Œæœç´¢
              const results = fuse.search(query);
              
              if (results.length === 0) {
                searchResults.classList.add('active');
                searchResults.innerHTML = '<div class="no-results">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
                return;
              }
              
              // æ˜¾ç¤ºæœç´¢ç»“æœ
              let html = `<div class="search-stats">æ‰¾åˆ° ${results.length} ä¸ªç»“æœ</div>`;
              
              html += results.slice(0, 30).map(result => {
                const item = result.item;
                // é«˜äº®æœç´¢å…³é”®è¯
                let content = item.content;
                const regex = new RegExp(`(${query})`, 'gi');
                content = content.replace(regex, '<mark>$1</mark>');
                
                return `
                  <div class="search-result-item" onclick="navigateToDoc('${item.path}')">
                    <span class="search-result-title">${item.title}</span>
                    <div class="search-result-content">${content}</div>
                  </div>
                `;
              }).join('');
              
              searchResults.classList.add('active');
              searchResults.innerHTML = html;
            }, 300);
          });
          
          // Ctrl+K å¿«æ·é”®èšç„¦æœç´¢æ¡†
          document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
              e.preventDefault();
              searchInput.focus();
            }
          });
        }
      }, 1000);
      
      // å¯¼èˆªåˆ°æ–‡æ¡£
      function navigateToDoc(path) {
        window.location.hash = path;
      }
      
      // åˆå§‹åŒ– Heti æ’ç‰ˆ
      function initHeti() {
        const contentArea = document.querySelector('.Content article');
        if (contentArea && typeof Heti !== 'undefined') {
          // ä¸ºå†…å®¹åŒºåŸŸæ·»åŠ  heti ç±»
          contentArea.classList.add('heti');
          
          // åˆ›å»º Heti å®ä¾‹å¹¶åº”ç”¨æ’ç‰ˆ
          const heti = new Heti('.heti');
          heti.autoSpacing(); // è‡ªåŠ¨ä¸ºä¸­è¥¿æ–‡ä¹‹é—´æ·»åŠ é—´è·
        }
      }
      
      // ç›‘å¬å†…å®¹å˜åŒ–ï¼Œè‡ªåŠ¨åº”ç”¨ Heti
      setTimeout(() => {
        // åˆæ¬¡åŠ è½½
        initHeti();
        
        // ç›‘å¬ URL å“ˆå¸Œå˜åŒ–ï¼ˆè·¯ç”±å˜åŒ–ï¼‰
        window.addEventListener('hashchange', () => {
          setTimeout(initHeti, 300);
        });
        
        // ä½¿ç”¨ MutationObserver ç›‘å¬ DOM å˜åŒ–
        const observer = new MutationObserver(() => {
          initHeti();
        });
        
        const docuteEl = document.getElementById('docute');
        if (docuteEl) {
          observer.observe(docuteEl, {
            childList: true,
            subtree: true
          });
        }
      }, 1500);
    </script>
  </body>
</html>