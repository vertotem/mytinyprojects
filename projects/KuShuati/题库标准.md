# 题库制作标准文档

## 📋 概述

本文档为后续开发者和内容创作者提供完整的题库制作标准和规范，确保所有题库文件都能与刷题系统完美兼容。

**最新更新：** 2024年10月 - 基于实际系统实现和标准演示题库优化

**支持的题型：**
- 单选题 (single) - 传统选择题
- 多选题 (multi) - 多个正确答案的选择题  
- 主观题-点击模式 (large-click) - 先思考后查看答案
- 主观题-输入模式 (large-input) - 需要用户输入答案

## 🏗️ 文件结构标准

### ZIP 包结构
每个题库必须打包为 ZIP 文件，包含以下标准结构：

```
题库名称.zip
├── 题库名称.db          # SQLite 数据库文件（必需）
└── images/             # 图片资源文件夹（可选）
    ├── image1.jpg
    ├── image2.png
    ├── diagram.svg
    └── ...
```

**重要规则：**
- ZIP 文件名应简洁明了，避免特殊字符
- 数据库文件名与 ZIP 文件名保持一致
- 图片文件夹必须命名为 `images`
- 支持的图片格式：jpg, jpeg, png, gif, bmp, webp, svg, tiff, ico

## 🗄️ 数据库结构标准

### 必需表：questions

```sql
CREATE TABLE questions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    question_bank_id TEXT NOT NULL,           -- 题库唯一标识符
    type TEXT NOT NULL,                       -- 题目类型
    content_html TEXT NOT NULL,               -- 题目内容（HTML格式）
    options_html TEXT,                        -- 选项内容（JSON格式）
    reference_answer_html TEXT NOT NULL,      -- 参考答案（HTML格式）
    correct_option_keys TEXT,                 -- 正确选项键
    score_value INTEGER DEFAULT 1,           -- 题目分值
    is_options_shuffled BOOLEAN DEFAULT 0    -- 选项是否乱序
);
```

### 可选表：question_bank_config

```sql
CREATE TABLE question_bank_config (
    id TEXT PRIMARY KEY,                      -- 题库ID（与question_bank_id对应）
    name TEXT NOT NULL,                       -- 题库显示名称
    description TEXT,                         -- 题库描述
    is_exam_mode BOOLEAN DEFAULT 0,          -- 是否为考试模式
    time_limit INTEGER DEFAULT 120,          -- 考试时间限制（分钟）
    created_time TEXT DEFAULT CURRENT_TIMESTAMP
);
```

## 📝 题目类型标准

### 1. 单选题 (single)

**字段要求：**
- `type`: "single"
- `options_html`: 必需，JSON 格式
- `correct_option_keys`: 必需，单个选项键（如 "B"）

**示例：**
```sql
INSERT INTO questions VALUES (
    NULL,
    'sample_bank',
    'single',
    '<p>1 + 1 = ?</p>',
    '{"A": "1", "B": "2", "C": "3", "D": "4"}',
    '<p><strong>参考答案：</strong>B</p><p><strong>解析：</strong>基础加法运算，1+1等于2</p>',
    'B',
    1,
    0
);
```

**选项格式标准：**
- 使用标准的 A、B、C、D... 作为选项键
- 选项值支持 HTML 格式，但建议保持简洁
- 选项数量建议 2-6 个

### 2. 多选题 (multi)

**字段要求：**
- `type`: "multi"
- `options_html`: 必需，JSON 格式
- `correct_option_keys`: 必需，多个选项键用逗号分隔（如 "A,C,D"）

**示例：**
```sql
INSERT INTO questions VALUES (
    NULL,
    'sample_bank',
    'multi',
    '<p>下列哪些是偶数？</p>',
    '{"A": "2", "B": "3", "C": "4", "D": "5", "E": "6"}',
    '<p><strong>参考答案：</strong>A,C,E</p><p><strong>解析：</strong>偶数是能被2整除的数，2、4、6都是偶数</p>',
    'A,C,E',
    2,
    0
);
```

### 3. 主观题-点击模式 (large-click)

**适用场景：** 概念解释、理论分析、开放性问题

**字段要求：**
- `type`: "large-click"
- `options_html`: NULL
- `correct_option_keys`: NULL

**示例：**
```sql
INSERT INTO questions VALUES (
    NULL,
    'sample_bank',
    'large-click',
    '<p>请解释什么是递归算法？</p>',
    NULL,
    '<p><strong>参考答案：</strong></p>
     <p>递归算法是指函数调用自身的编程技巧...</p>
     <p><strong>关键要素：</strong></p>
     <ul><li>基本情况（终止条件）</li><li>递归调用</li></ul>',
    NULL,
    5,
    0
);
```

### 4. 主观题-输入模式 (large-input)

**适用场景：** 计算题、编程题、需要具体答案的问题

**字段要求：**
- `type`: "large-input"
- `options_html`: NULL
- `correct_option_keys`: NULL

**示例：**
```sql
INSERT INTO questions VALUES (
    NULL,
    'sample_bank',
    'large-input',
    '<p>编写一个计算阶乘的函数（JavaScript）</p>',
    NULL,
    '<p><strong>参考答案：</strong></p>
     <pre><code>function factorial(n) {
       if (n <= 1) return 1;
       return n * factorial(n - 1);
     }</code></pre>',
    NULL,
    10,
    0
);
```

## 🖼️ 图片使用标准

### 图片引用规范

**HTML 中的引用格式：**
```html
<img src="images/filename.png" alt="描述文字" style="max-width: 400px;">
```

**重要规则：**
- 路径必须以 `images/` 开头
- 必须包含 `alt` 属性用于无障碍访问
- 建议设置 `max-width` 限制图片大小
- 图片文件名使用英文和数字，避免特殊字符

### 图片质量标准

- **分辨率：** 建议 72-150 DPI
- **文件大小：** 单个图片不超过 5MB
- **格式选择：**
  - 照片：使用 JPG 格式
  - 图表/示意图：使用 PNG 格式
  - 矢量图：使用 SVG 格式

## 📊 内容编写标准

### HTML 内容规范

**允许使用的 HTML 标签：**
```html
<!-- 基础结构 -->
<p>, <div>, <span>

<!-- 文本格式 -->
<strong>, <em>, <u>, <br>

<!-- 列表 -->
<ul>, <ol>, <li>

<!-- 表格 -->
<table>, <tr>, <td>, <th>

<!-- 代码 -->
<code>, <pre>

<!-- 图片 -->
<img>

<!-- 数学公式（支持 MathJax） -->
<math>, $$..$$, $...$
```

**禁止使用：**
- JavaScript 代码
- 外部 CSS 链接
- iframe 标签
- 表单元素

### 内容质量标准

**题目内容：**
- 语言准确、简洁明了
- 避免歧义和模糊表达
- 包含必要的背景信息
- 难度适中，符合目标用户群体

**参考答案格式标准：**
- 必须以 `<p><strong>参考答案：</strong>` 开头
- 选择题显示正确选项（如 "B" 或 "A,C,E"）
- 主观题提供完整的答案内容
- 解析部分使用 `<p><strong>解析：</strong>` 开头
- 支持HTML格式化：`<strong>`, `<em>`, `<ul>`, `<li>`, `<pre>`, `<code>`
- 对于代码题，使用 `<pre><code>` 标签包装代码

## ⚙️ 技术规范

### 数据库约束

**字符编码：** UTF-8
**数据库引擎：** SQLite 3.x
**最大题目数量：** 建议单个题库不超过 1000 题

### 性能优化

**必需索引：**
```sql
CREATE INDEX idx_questions_bank_id ON questions(question_bank_id);
CREATE INDEX idx_questions_type ON questions(type);
```

**数据验证：**
- 所有 TEXT 字段不能为空字符串
- JSON 格式必须有效
- 分值必须为正整数

## 🎯 模式配置标准

### 练习模式配置

```sql
INSERT INTO question_bank_config VALUES (
    'practice_bank_id',
    '练习题库名称',
    '题库描述信息',
    0,                    -- is_exam_mode = 0
    NULL,                 -- time_limit 可为空
    CURRENT_TIMESTAMP
);
```

### 考试模式配置

```sql
INSERT INTO question_bank_config VALUES (
    'exam_bank_id',
    '考试题库名称',
    '考试说明信息',
    1,                    -- is_exam_mode = 1
    120,                  -- time_limit 分钟数
    CURRENT_TIMESTAMP
);
```

## 🔧 制作工具推荐

### 自动化生成工具
- **`generate_comprehensive_demo_bank.py`** - 标准题库生成器，包含所有题型示例
- **`generate_sample_exam_bank.py`** - 综合能力测试题库生成器

### 验证工具
- **`validate_database.py`** - 题库完整性校验工具
- **`check_db_structure.py`** - 数据库结构检查工具

### 数据库工具
- **DB Browser for SQLite** - 可视化数据库编辑
- **SQLite Studio** - 专业数据库管理
- **命令行 sqlite3** - 批量操作

### 图片处理
- **GIMP** - 免费图像编辑器
- **TinyPNG** - 在线图片压缩
- **Inkscape** - 矢量图编辑

### 开发辅助
- **Visual Studio Code** - 代码编辑器
- **Python 3.x** - 运行生成和验证脚本
- **Git** - 版本控制

## 📋 质量检查清单

### 文件结构检查
- [ ] ZIP 文件包含 .db 文件
- [ ] 图片文件在 images/ 文件夹中
- [ ] 文件命名规范，无特殊字符
- [ ] 文件大小合理（ZIP < 50MB）

### 数据库检查
- [ ] 包含必需的 questions 表
- [ ] 所有字段类型正确
- [ ] 必需字段不为空
- [ ] JSON 格式有效
- [ ] 创建了性能索引

### 内容质量检查
- [ ] 题目表述清晰准确
- [ ] 选项设置合理
- [ ] 参考答案格式符合标准（包含 `<strong>参考答案：</strong>` 和 `<strong>解析：</strong>`）
- [ ] 图片引用路径正确（以 `images/` 开头）
- [ ] HTML 标签使用规范
- [ ] 主观题的 `options_html` 和 `correct_option_keys` 字段为 NULL
- [ ] 选择题的选项使用标准 A、B、C、D 格式

### 功能测试
- [ ] 使用 `validate_database.py` 校验无错误
- [ ] 导入系统无错误
- [ ] 题目显示正常
- [ ] 图片加载成功
- [ ] 答案判断正确
- [ ] 考试模式配置有效
- [ ] 主观题-点击模式正常工作
- [ ] 主观题-输入模式正常工作

## 🚀 发布流程

### 1. 开发阶段
1. 参考 `generate_comprehensive_demo_bank.py` 设计题库结构
2. 准备图片资源（放入 images/ 文件夹）
3. 编写题目内容（遵循HTML格式标准）
4. 创建数据库文件和配置

### 2. 测试阶段
1. 运行 `validate_database.py` 进行完整性校验
2. 运行 `check_db_structure.py` 检查数据库结构
3. 本地导入测试
4. 功能完整性验证（所有题型）
5. 性能测试
6. 用户体验测试

### 3. 发布阶段
1. 最终质量检查（使用检查清单）
2. 打包 ZIP 文件（包含 .db 文件和 images/ 文件夹）
3. 编写使用说明
4. 版本标记和发布

## 📚 示例资源

### 参考文件
- `generate_comprehensive_demo_bank.py` - 标准题库生成器
- `标准演示题库.zip` - 包含所有题型的完整示例
- `综合能力测试题库.zip` - 考试模式示例
- `文学常识Part1.db` - 实际题库示例

### 学习资源
- `需求文档.md` - 系统功能需求
- `使用指南.md` - 用户使用指南
- `validate_database.py` - 题库校验工具
- `check_db_structure.py` - 数据库结构检查工具

## 🔄 版本管理

### 版本号规范
使用语义化版本号：`主版本.次版本.修订版本`
- 主版本：不兼容的 API 修改
- 次版本：向下兼容的功能性新增
- 修订版本：向下兼容的问题修正

### 更新日志
每次更新需要记录：
- 新增功能
- 修复问题
- 改进内容
- 兼容性说明

## 📞 技术支持

### 常见问题解决
1. **导入失败：** 检查 ZIP 结构和数据库格式，运行 `validate_database.py` 校验
2. **图片不显示：** 验证图片路径以 `images/` 开头，检查文件格式
3. **题目乱码：** 确保使用 UTF-8 编码
4. **性能问题：** 检查题目数量和图片大小
5. **主观题显示异常：** 确保 `options_html` 和 `correct_option_keys` 为 NULL
6. **答案格式错误：** 检查参考答案是否包含标准的 `<strong>` 标签格式

### 联系方式
- 技术文档：参考项目根目录下的相关 .md 文件
- 问题反馈：通过项目 issue 系统
- 开发交流：参考项目贡献指南

---

**制作愉快！** 🎉

> 本标准文档将随着系统功能的完善而持续更新，请关注最新版本。
